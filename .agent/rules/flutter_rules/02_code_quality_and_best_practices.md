---
trigger: model_decision
description: 适用于代码重构、提升代码质量、遵循 Dart 官方最佳实践以及优化 Flutter Widget 开发逻辑。包含命名规范、空安全、异步编程及性能优化建议。
---

# 02. 代码质量与最佳实践

本节包含了代码质量提升、Dart 语言最佳实践以及 Flutter 框架最佳实践。

## 代码质量 (Code Quality)

*   **代码结构:** 遵守可维护的代码结构和关注点分离（例如：UI 逻辑与业务逻辑分离）。
*   **命名约定:** 避免缩写，为变量、函数和类使用有意义、一致且描述性的名称。
*   **简洁性:** 在保持清晰的前提下，尽可能减少代码量。
*   **简单性:** 编写直白的代码。聪明或晦涩的代码难以维护。
*   **错误处理:** 预见并处理潜在错误。不要让代码静默失败。
*   **样式规范 (Styling):**
    *   行宽：每行不应超过 80 个字符。
    *   遵循：类名使用 `PascalCase`，成员/变量/函数/枚举使用 `camelCase`，文件名使用 `snake_case`。
*   **函数:** 保持函数简短且目的单一（力争少于 20 行）。
*   **测试导向:** 编写代码时考虑可测试性。在适当的情况下使用 `file`, `process`, 和 `platform` 包，以便注入内存中或虚假的库。
*   **日志:** 使用 `logging` 包替代 `print`。

## Dart 最佳实践 (Dart Best Practices)

*   **Effective Dart:** 遵循官方的 Effective Dart 指南 (https://dart.dev/effective-dart)。
*   **类组织:** 在同一个库文件中定义相关的类。对于大型库，通过一个顶层库导出较小的私有库。
*   **库组织:** 将相关的库放在同一个文件夹中。
*   **API 文档:** 为所有公共 API（类、构造函数、方法、顶层函数）添加文档注释。
*   **注释:** 为复杂或不直观的代码编写清晰的注释。避免过度注释。
*   **尾随注释:** 不要添加尾随注释。
*   **Async/Await:** 确保正确使用 `async`/`await` 进行异步操作，并具备鲁棒的错误处理。
    *   使用 `Future`、`async` 和 `await` 执行异步操作。
    *   使用 `Stream` 处理异步事件序列。
*   **空安全:** 编写健壮的空安全代码。利用 Dart 的空安全特性。除非能保证值非空，否则避免使用 `!`。
*   **模式匹配:** 在能简化代码的地方使用模式匹配特性。
*   **记录 (Records):** 在定义完整类过于繁琐的情况下，使用 Records 返回多个类型。
*   **Switch 语句:** 优先使用详尽的 switch 语句或表达式，不需要 `break`。
*   **异常处理:** 使用 `try-catch` 块处理异常，并使用与异常类型匹配的处理方式。针对代码特定情况使用自定义异常。
*   **箭头函数:** 对于简单的单行函数，使用箭头语法。

## Flutter 最佳实践 (Flutter Best Practices)

*   **不可变性:** Widget（尤其是 `StatelessWidget`）是不可变的；当 UI 需要变化时，Flutter 会重建 Widget 树。
*   **组合:** 偏好组合小型 Widget，而非扩展现有 Widget。利用这一点避免深层 Widget 嵌套。
*   **私有 Widget:** 使用小型私有 Widget 类，而非返回 Widget 的私有辅助方法。
*   **Build 方法:** 将大型 `build()` 方法拆分为更小、可复用的私有 Widget 类。
*   **列表性能:** 对于长列表，使用 `ListView.builder` 或 `SliverList` 以实现延迟加载，提高性能。
*   **Isolate:** 使用 `compute()` 在单独的 Isolate 中运行昂贵的计算（如 JSON 解析），避免阻塞 UI 线程。
*   **Const 构造函数:** 尽可能在 `build()` 方法中使用 `const` 构造函数，以减少重建。
*   **Build 方法性能:** 避免直接在 `build()` 方法中执行昂贵的操作，如网络请求或复杂计算。